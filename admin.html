<!--
 * Copyright (C) 2020 Eliastik (eliastiksofts.com)
 *
 * This file is part of "SnakeIA Server".
 *
 * "SnakeIA Server" is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * "SnakeIA Server" is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with "SnakeIA Server".  If not, see <http://www.gnu.org/licenses/>. -->
 <!doctype HTML>
 <html>
  <head>
    <meta charset="UTF-8"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/flat-ui.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <% if(enableRecaptcha && publicKey) { %><script src="https://www.google.com/recaptcha/api.js?hl=<%= locale %>" async defer></script><% } %>
    <title>SnakeIA Server</title>
  </head>
  <body class="text-center">
    <div class="container">
      <div class="row">
          <div class="col">
            <p><img class="logo" src="/img/logo.png" alt="SnakeIA Server" /></p>
            <h2><%= __("adminTitle") %></h2>
            <% if(authent && games) {
              const gamesKeys = Object.keys(games);
              let currentRoom = 1;

              gamesKeys.forEach(key => {
                if(games[key]) { %>
                <h3><%= __("roomAdmin", currentRoom, key) %></h3>
              <%
                const users = [];
                  games[key].players.forEach(player => users.push(player));
                  games[key].spectators.forEach(player => users.push(player));
              %>
              <ul class="list-group">
                <% users.forEach(user => { %>
                  <li class="list-group-item">
                    <strong><%= __("usernameAdmin") %></strong> <%= user.username %><br />
                    <strong><%= __("idSocket") %></strong> <%= user.id %><br />
                    <strong><%= __("ip") %></strong> <%= user.id && io.sockets.connected[user.id] && io.sockets.connected[user.id].handshake.address %><br />
                    <strong><%= __("clientVersion") %></strong> <%= user.version %><br />
                    <a href="?action=kick&socket=<%= user.id %>&token=<%= user.token %>" class="btn btn-primary"><%= __("kick") %></a>
                    <a href="?action=banIP&socket=<%= user.id %>&token=<%= user.token %>" class="btn btn-primary"><%= __("banIP") %></a>
                    <a href="?action=banUserName&socket=<%= user.id %>&token=<%= user.token %>" class="btn btn-primary"><%= __("banUsername") %></a>
                    <a href="?action=banIPUserName&socket=<%= user.id %>&token=<%= user.token %>" class="btn btn-primary"><%= __("banUsernameIP") %></a>
                  </li>
                <% });
                currentRoom++;
              } %>
              <% }); %>
            </ul>
            <hr />
            <p><a href="?disconnect=true" class="btn btn-primary"><%= __("disconnectAdmin") %></a></p>
            <% } else { %>
            <form action="" method="post">
              <fieldset class="form-group">
                <div class="form-group row">
                  <label for="username" class="col-12 col-form-label"><%= __("usernameAdmin") %></label>
                  <div class="col-12">
                    <input type="text" id="username" name="username" class="form-control">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="password" class="col-12 col-form-label"><%= __("passwordAdmin") %></label>
                  <div class="col-12">
                    <input type="password" id="password" name="password" class="form-control">
                  </div>
                </div>
                <% if(enableRecaptcha && publicKey) { %>
                <div class="form-group row">
                  <div class="col-12">
                    <div class="g-recaptcha" data-sitekey="<%= publicKey %>"></div>
                    <% if(errorRecaptcha) { %><div class="text-danger"><span class="fui-cross-circle mr-1"></span> <%= __("errorRecaptcha") %></div><% } %>
                  </div>
                </div>
                <% } %>
                <% if(errorAuthent) { %>
                <div class="form-group row">
                  <div class="col-12">
                    <div class="text-danger"><span class="fui-cross-circle mr-1"></span> <%= __("errorAuthentAdmin") %></div>
                  </div>
                </div>
                <% } %>
                <div class="form-group row">
                  <div class="col-12">
                    <button type="submit" name="submit" class="btn btn-lg btn-primary"><span class="fui-check mr-2"></span> <%= __("submit") %></button>
                  </div>
                </div>
              </fieldset>
            </form>
            <% } %>
          </div>
        </div>
    </div>
  </body>
</html>